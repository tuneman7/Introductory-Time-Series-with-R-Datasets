---
title: "chapter2"
output: html_document
date: '2022-06-11'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown


```{r setup echo=FALSE, message=FALSE, warnings=FALSE}
list.of.packages <- c("rstudioapi","tidyverse")

new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
library(rstudioapi)
library(tidyverse)
get_my_wd <- function()
{
  current_doc <- getActiveDocumentContext()$path 
  current_path <- str_replace(str_replace(paste(gsub("(.*)/.*","\\1",current_doc),"")," ",""), " ","")
  return(current_path)
}

directory <-get_my_wd()

r_file = paste(directory,"/functions.R",sep="")
print(get_my_wd())
print(r_file)

source(r_file)
```
# 2.2.1 Expected value

We now use R to calculate the covariance for the Herald Square pairs in
three different ways:


```{r pressure, echo=FALSE}

Herald.dat <- read.table(fileandpath("Herald.dat"), header = T)
attach (Herald.dat)

x <- Herald.dat$CO; y <- Herald.dat$Benzoa; n <- length(x)
```
```{r}
sum((x - mean(x))*(y - mean(y))) / (n - 1)
```
```{r}
mean((x - mean(x)) * (y - mean(y)))
```
```{r}

cov(x, y)
```

The correspondence between the R code above and the expectation defini-
  tion of covariance should be noted:
mean((x - mean(x))*(y - mean(y))) → E [(x − μx )(y − μy )]

```{r}
cov(x,y) / (sd(x)*sd(y))
```
```{r}
cor(x,y)
```

# 2.2.5 Autocorrelation

 We will demonstrate the calculations in R using a time series of wave
 heights (mm relative to still water level) measured at the centre of a wave tank.
 The sampling interval is 0.1 second and the record length is 39.7 seconds. The
 waves were generated by a wave maker driven by a pseudo-random signal that
 was programmed to emulate a rough sea. There is no trend and no seasonal
 period, so it is reasonable to suppose the time series is a realisation of a
 stationary process.


```{r}
wave.dat <- read.table (fileandpath("wave.dat"), header=T) ; 
attach(wave.dat)
```
```{r}
layout (1:2)
plot(ts(waveht)) 
plot(ts(waveht[1:60]))
```


```{r}
# The autocorrelations of x are stored in the vector acf(x)$acf, with the
# lag k autocorrelation located in acf(x)$acf[k+1]. For example, the lag 1
# autocorrelation for waveht is
acf(waveht)$acf[2]
```

```{r}
acf(waveht)$acf[1]
```

```{r}

plot(waveht[1:396],waveht[2:397]) 
```


```{r}
 acf(waveht, type = c("covariance"))$acf[2]
```

#2.3 The correlogram
##2.3.1 General discussion


```{r}


```


#2.3.2 Example based on air passenger series

```{r}
data(AirPassengers)
AP <- AirPassengers
AP.decom <- decompose(AP, "multiplicative")
```

```{r}
plot(ts(AP.decom$random[7:138]))
```

```{r}
acf(AP.decom$random[7:138])
```

```{r}
output<- c(
           toString(sd(AP[7:138])) ,   
           toString(sd(AP[7:138] - AP.decom$trend[7:138])) ,
           toString(sd(AP.decom$random[7:138])) 
           )
cat(paste(output, collapse="\n"))
```

#2.3.3 Example based on the Font Reservoir series

```{r , echo=FALSE, message=FALSE, warnings=FALSE}

Fontdsdt.dat <- read.table(fileandpath("Fontdsdt.dat"), header=T)
attach(Fontdsdt.dat)
plot(ts(adflow), ylab = 'adflow')

```
```{r}
acf(adflow, xlab = 'lag (months)', main="")
```

